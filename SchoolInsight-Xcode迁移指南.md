# School Insight è¿ç§»åˆ° Xcode å¼€å‘æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°† School Insight çš„å®Œæ•´åŠŸèƒ½è¿ç§»åˆ° Xcode è¿›è¡Œ iOS åŸç”Ÿåº”ç”¨å¼€å‘ã€‚

## ğŸ“ å¿«é€Ÿå‚è€ƒï¼šå…³é”®ä»£ç æ–‡ä»¶è·¯å¾„

**å»ºè®®å…ˆæŸ¥çœ‹ä»¥ä¸‹ä»£ç æ–‡ä»¶ä»¥äº†è§£å®é™…å®ç°ï¼š**

| åŠŸèƒ½æ¨¡å— | æ–‡ä»¶è·¯å¾„ | å…³é”®ä»£ç ä½ç½® | è¯´æ˜ |
|---------|---------|-------------|------|
| **æ•°æ®æ¨¡å‹** | `server.js` | ç¬¬ 40-89 è¡Œ | School æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆåŒ…å« schoolTypeã€affiliatedGroupï¼‰ |
| **å­¦æ ¡æœç´¢** | `server.js` | ç¬¬ 254-395 è¡Œ | å­¦æ ¡åˆ—è¡¨å’Œæœç´¢ API |
| **æ•™è‚²é›†å›¢æŸ¥è¯¢** | `server.js` | ç¬¬ 360-395 è¡Œ | æ ¹æ®æ•™è‚²é›†å›¢æŸ¥è¯¢å­¦æ ¡ API |
| **æµå¼AIè¯„ä¼°** | `server.js` | ç¬¬ 1132-1350 è¡Œ | æµå¼AIè¯„åˆ†å¯¹æ¯”åç«¯å®ç°ï¼ˆSSEï¼‰ |
| **æ ‡å‡†AIè¯„ä¼°** | `server.js` | ç¬¬ 1353-1636 è¡Œ | æ ‡å‡†AIè¯„åˆ†å¯¹æ¯”åç«¯å®ç° |
| **å‰ç«¯æµå¼å¤„ç†** | `js/schoolinsight.js` | ç¬¬ 869-1001 è¡Œ | æµå¼è¯„ä¼°å‰ç«¯å®ç°ï¼ˆhandleCompareScoringStreamï¼‰ |
| **å‰ç«¯æ•™è‚²é›†å›¢** | `js/schoolinsight.js` | ç¬¬ 1238-1280 è¡Œ | æ•™è‚²é›†å›¢æŸ¥è¯¢å‰ç«¯å®ç° |
| **å­—æ®µå…¼å®¹å¤„ç†** | `js/schoolinsight.js` | ç¬¬ 1108-1236 è¡Œ | schoolType/nature å…¼å®¹å¤„ç† |
| **UIç•Œé¢** | `schoolinsight.html` | å…¨æ–‡ | å®Œæ•´çš„HTMLç»“æ„å’Œæ ·å¼ |
| **APIæ–‡æ¡£** | `SchoolInsight-APIæ¥å£æ¸…å•.md` | å…¨æ–‡ | å®Œæ•´çš„APIæ¥å£æ–‡æ¡£ |

> ğŸ’¡ **æç¤º**ï¼šæ‰€æœ‰æ–‡ä»¶è·¯å¾„åŸºäºé¡¹ç›®æ ¹ç›®å½•ã€‚å¯ä»¥ç›´æ¥åœ¨ä»£ç ä»“åº“ä¸­æœç´¢è¿™äº›æ–‡ä»¶æŸ¥çœ‹å…·ä½“å®ç°ã€‚

## ä¸€ã€åŠŸèƒ½æ¦‚è§ˆ

School Insight æ˜¯ä¸€ä¸ªå­¦æ ¡æŸ¥è¯¢ä¸å¯¹æ¯”ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

### 1.1 å‰ç«¯åŠŸèƒ½ï¼ˆWebï¼‰
- **å­¦æ ¡æœç´¢**ï¼šæ”¯æŒæŒ‰å­¦æ ¡åç§°æœç´¢
- **å­¦æ ¡åˆ—è¡¨å±•ç¤º**ï¼šå¡ç‰‡å¼å±•ç¤ºæœç´¢ç»“æœ
- **å­¦æ ¡è¯¦æƒ…æŸ¥çœ‹**ï¼šå¼¹çª—æ˜¾ç¤ºå­¦æ ¡è¯¦ç»†ä¿¡æ¯
- **å¤šå­¦æ ¡å¯¹æ¯”**ï¼š
  - åŸºç¡€å¯¹æ¯”ï¼ˆåŸºæœ¬ä¿¡æ¯ã€å­¦æ®µã€è¯¾ç¨‹ç­‰ï¼‰
  - AI è¯„ä¼°å¯¹æ¯”ï¼ˆé‡åŒ–è¯„åˆ†å¯¹æ¯”ï¼‰
- **AI è¾…åŠ©åŠŸèƒ½**ï¼š
  - è‡ªåŠ¨è¡¥å……å­¦æ ¡ç¼ºå¤±ä¿¡æ¯
  - æ™ºèƒ½æœç´¢å¯èƒ½çš„å­¦æ ¡åç§°
  - AI è¯„åˆ†è¯„ä¼°

### 1.2 åç«¯ API
- `GET /api/schools` - è·å–å­¦æ ¡åˆ—è¡¨ï¼ˆæ”¯æŒæœç´¢ï¼‰
- `GET /api/schools/:id` - è·å–å•ä¸ªå­¦æ ¡è¯¦æƒ…
- `GET /api/schools/by-group/:groupName` - æ ¹æ®æ•™è‚²é›†å›¢æŸ¥è¯¢å­¦æ ¡
- `POST /api/schools/create-from-name` - æ ¹æ®åç§°åˆ›å»ºå­¦æ ¡
- `POST /api/schools/compare` - åŸºç¡€å¯¹æ¯”
- `POST /api/schools/compare-scoring` - AI è¯„åˆ†å¯¹æ¯”ï¼ˆæ ‡å‡†ç‰ˆæœ¬ï¼‰
- `POST /api/schools/compare-scoring-stream` - AI è¯„åˆ†å¯¹æ¯”ï¼ˆæµå¼ç‰ˆæœ¬ï¼Œæ”¯æŒå®æ—¶è¿›åº¦ï¼‰

## äºŒã€æŠ€æœ¯æ¶æ„åˆ†æ

### 2.1 å‰ç«¯æŠ€æœ¯æ ˆ
- **HTML/CSS/JavaScript**ï¼šçº¯å‰ç«¯å®ç°
- **æ ·å¼**ï¼šè‡ªå®šä¹‰ CSSï¼Œå“åº”å¼è®¾è®¡
- **çŠ¶æ€ç®¡ç†**ï¼šåŸç”Ÿ JavaScript å˜é‡å’Œ Map/Set
- **API è°ƒç”¨**ï¼šFetch API

### 2.2 åç«¯æŠ€æœ¯æ ˆ
- **Node.js + Express**ï¼šRESTful API æœåŠ¡å™¨
- **MongoDB + Mongoose**ï¼šæ•°æ®åº“å’Œ ODM
- **AI é›†æˆ**ï¼šDeepseek APIï¼ˆç”¨äºå­¦æ ¡ä¿¡æ¯è¡¥å……å’Œè¯„åˆ†ï¼‰

### 2.3 æ•°æ®æ¨¡å‹
å­¦æ ¡æ•°æ®åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- **åŸºæœ¬ä¿¡æ¯**ï¼šåºå·ã€åç§°ã€ç½‘å€ã€å›½å®¶ã€åŸå¸‚ã€å­¦æ ¡ç±»å‹ï¼ˆschoolTypeï¼‰ã€æ¶µç›–å­¦æ®µã€éš¶å±æ•™è‚²é›†å›¢ï¼ˆaffiliatedGroupï¼‰
- **å­¦æ®µè®¾ç½®**ï¼šå¹¼å„¿å›­ã€å°å­¦ã€åˆä¸­ã€é«˜ä¸­
- **IB è¯¾ç¨‹**ï¼šPYPã€MYPã€DPã€CP
- **å…¶ä»–è¯¾ç¨‹**ï¼šA-Levelã€APã€åŠ æ‹¿å¤§è¯¾ç¨‹ã€æ¾³å¤§åˆ©äºšè¯¾ç¨‹ã€IGCSEã€å…¶ä»–è¯¾ç¨‹
- **AI è¯„ä¼°å­—æ®µ**ï¼šæ€»åˆ†ã€å„ç»´åº¦å¾—åˆ†å’Œè¯´æ˜ã€æœ€ç»ˆæ€»ç»“

**å­—æ®µè¯´æ˜**ï¼š
- `schoolType`ï¼šå­¦æ ¡ç±»å‹ï¼ˆæ–°å¢å­—æ®µï¼Œæ›¿ä»£/å…¼å®¹æ—§çš„ `nature` å­—æ®µï¼‰
  - å¯èƒ½å€¼ï¼š`"å…¬ç«‹å­¦æ ¡"`ã€`"æ™®é€šæ°‘åŠå­¦æ ¡"`ã€`"æ°‘åŠåŒè¯­å­¦æ ¡"`ã€`"å…¬ç«‹å­¦æ ¡ï¼ˆå›½é™…éƒ¨ï¼‰"`
- `affiliatedGroup`ï¼šéš¶å±æ•™è‚²é›†å›¢ï¼ˆæ–°å¢å­—æ®µï¼‰
  - å¦‚æœå­¦æ ¡éš¶å±äºæŸä¸ªæ•™è‚²é›†å›¢ï¼Œå¡«å†™é›†å›¢åç§°
  - å¦‚æœæ²¡æœ‰éš¶å±ä»»ä½•æ•™è‚²é›†å›¢ï¼Œå€¼ä¸º `"æ— "`
- `nature`ï¼šå­¦æ ¡æ€§è´¨ï¼ˆæ—§å­—æ®µï¼Œä¿ç•™ä»¥å…¼å®¹æ—§æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨ `schoolType`ï¼‰

## ä¸‰ã€è¿ç§»åˆ° Xcode çš„æ­¥éª¤

### 3.1 åˆ›å»º iOS é¡¹ç›®

1. **åœ¨ Xcode ä¸­åˆ›å»ºæ–°é¡¹ç›®**
   - é€‰æ‹© "iOS" > "App"
   - ä½¿ç”¨ SwiftUI æˆ– UIKitï¼ˆæ¨è SwiftUIï¼‰
   - é¡¹ç›®åç§°ï¼šSchoolInsight

2. **é¡¹ç›®ç»“æ„å»ºè®®**
   ```
   SchoolInsight/
   â”œâ”€â”€ Models/
   â”‚   â”œâ”€â”€ School.swift
   â”‚   â””â”€â”€ ScoringData.swift
   â”œâ”€â”€ Views/
   â”‚   â”œâ”€â”€ SearchView.swift
   â”‚   â”œâ”€â”€ SchoolListView.swift
   â”‚   â”œâ”€â”€ SchoolDetailView.swift
   â”‚   â”œâ”€â”€ CompareView.swift
   â”‚   â””â”€â”€ ScoringCompareView.swift
   â”œâ”€â”€ ViewModels/
   â”‚   â”œâ”€â”€ SchoolViewModel.swift
   â”‚   â””â”€â”€ CompareViewModel.swift
   â”œâ”€â”€ Services/
   â”‚   â”œâ”€â”€ APIService.swift
   â”‚   â””â”€â”€ NetworkManager.swift
   â”œâ”€â”€ Utilities/
   â”‚   â””â”€â”€ Constants.swift
   â””â”€â”€ Resources/
       â””â”€â”€ Assets.xcassets
   ```

### 3.2 æ•°æ®æ¨¡å‹è½¬æ¢

#### 3.2.1 åˆ›å»º School æ¨¡å‹ï¼ˆSwiftï¼‰

```swift
import Foundation

struct School: Codable, Identifiable {
    let id: String
    let sequenceNumber: Int?
    let name: String
    let website: String?
    let country: String?
    let city: String?
    let schoolType: String? // å­¦æ ¡ç±»å‹ï¼ˆæ–°å¢ï¼Œä¼˜å…ˆä½¿ç”¨ï¼‰
    let nature: String? // å­¦æ ¡æ€§è´¨ï¼ˆæ—§å­—æ®µï¼Œä¿ç•™å…¼å®¹ï¼‰
    let coveredStages: String?
    let affiliatedGroup: String? // éš¶å±æ•™è‚²é›†å›¢ï¼ˆæ–°å¢ï¼‰
    
    // å­¦æ®µè®¾ç½®
    let kindergarten: String?
    let primary: String?
    let juniorHigh: String?
    let seniorHigh: String?
    
    // IBè¯¾ç¨‹
    let ibPYP: String?
    let ibMYP: String?
    let ibDP: String?
    let ibCP: String?
    
    // å…¶ä»–è¯¾ç¨‹
    let aLevel: String?
    let ap: String?
    let canadian: String?
    let australian: String?
    let igcse: String?
    let otherCourses: String?
    
    // AIè¯„ä¼°å­—æ®µ
    let aiè¯„ä¼°æ€»åˆ†: Double?
    let aiè¯„ä¼°è¯¾ç¨‹å£°èª‰ä¸ä½“ç³»æˆç†Ÿåº¦å¾—åˆ†: Double?
    let aiè¯„ä¼°è¯¾ç¨‹å£°èª‰ä¸ä½“ç³»æˆç†Ÿåº¦è¯´æ˜: String?
    // ... å…¶ä»–AIè¯„ä¼°å­—æ®µ
    
    // è®¡ç®—å±æ€§ï¼šè·å–å­¦æ ¡ç±»å‹ï¼ˆä¼˜å…ˆä½¿ç”¨schoolTypeï¼Œå…¼å®¹natureï¼‰
    var displaySchoolType: String? {
        return schoolType ?? nature
    }
    
    enum CodingKeys: String, CodingKey {
        case id = "_id"
        case sequenceNumber
        case name
        case website
        case country
        case city
        case schoolType
        case nature
        case coveredStages
        case affiliatedGroup
        case kindergarten
        case primary
        case juniorHigh
        case seniorHigh
        case ibPYP
        case ibMYP
        case ibDP
        case ibCP
        case aLevel
        case ap
        case canadian
        case australian
        case igcse
        case otherCourses
        case aiè¯„ä¼°æ€»åˆ† = "AIè¯„ä¼°_æ€»åˆ†"
        case aiè¯„ä¼°è¯¾ç¨‹å£°èª‰ä¸ä½“ç³»æˆç†Ÿåº¦å¾—åˆ† = "AIè¯„ä¼°_è¯¾ç¨‹å£°èª‰ä¸ä½“ç³»æˆç†Ÿåº¦_å¾—åˆ†"
        case aiè¯„ä¼°è¯¾ç¨‹å£°èª‰ä¸ä½“ç³»æˆç†Ÿåº¦è¯´æ˜ = "AIè¯„ä¼°_è¯¾ç¨‹å£°èª‰ä¸ä½“ç³»æˆç†Ÿåº¦_è¯´æ˜"
        // ... å…¶ä»–å­—æ®µæ˜ å°„
    }
}
```

#### 3.2.2 åˆ›å»º API å“åº”æ¨¡å‹

```swift
struct SchoolsResponse: Codable {
    let schools: [School]
    let total: Int
    let page: Int
    let limit: Int
    let totalPages: Int
    let possibleSchoolNames: [String]?
}

struct CompareResponse: Codable {
    let schools: [School]
}

struct ScoringResponse: Codable {
    let schools: [School]
    let scoring: ScoringData
    let warning: ScoringWarning? // è¯„åˆ†è­¦å‘Šï¼ˆå¦‚å­¦æ ¡æ€§è´¨ä¸ä¸€è‡´ï¼‰
}

struct ScoringWarning: Codable {
    let type: String
    let message: String
}

struct SchoolsByGroupResponse: Codable {
    let schools: [School]
    let total: Int
    let groupName: String
}

struct ScoringData: Codable {
    let comparisonTable: [ComparisonRow]
    let totalScores: [String: Double]
    let summary: [String: SchoolSummary]
}

struct ComparisonRow: Codable {
    let dimension: String
    let indicator: String
    let weight: Int
    let scores: [String: Double]
    let explanations: [String: String]
}

struct SchoolSummary: Codable {
    let totalScore: Double
    let strengths: String?
    let characteristics: String?
    let suitableFor: String?
}
```

### 3.3 API æœåŠ¡å±‚å®ç°

#### 3.3.1 åˆ›å»º APIService

```swift
import Foundation

class APIService {
    static let shared = APIService()
    
    private let baseURL = "https://mooyu.cc/api" // æˆ–ä½ çš„æœåŠ¡å™¨åœ°å€
    
    private init() {}
    
    // MARK: - è·å–å­¦æ ¡åˆ—è¡¨
    func searchSchools(query: String, page: Int = 1, limit: Int = 20) async throws -> SchoolsResponse {
        var components = URLComponents(string: "\(baseURL)/schools")!
        components.queryItems = [
            URLQueryItem(name: "search", value: query),
            URLQueryItem(name: "page", value: "\(page)"),
            URLQueryItem(name: "limit", value: "\(limit)")
        ]
        
        guard let url = components.url else {
            throw APIError.invalidURL
        }
        
        let (data, _) = try await URLSession.shared.data(from: url)
        return try JSONDecoder().decode(SchoolsResponse.self, from: data)
    }
    
    // MARK: - è·å–å•ä¸ªå­¦æ ¡è¯¦æƒ…
    func getSchool(id: String) async throws -> School {
        guard let url = URL(string: "\(baseURL)/schools/\(id)") else {
            throw APIError.invalidURL
        }
        
        let (data, _) = try await URLSession.shared.data(from: url)
        return try JSONDecoder().decode(School.self, from: data)
    }
    
    // MARK: - åˆ›å»ºå­¦æ ¡
    func createSchool(name: String) async throws -> School {
        guard let url = URL(string: "\(baseURL)/schools/create-from-name") else {
            throw APIError.invalidURL
        }
        
        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        
        let body = ["schoolName": name]
        request.httpBody = try JSONEncoder().encode(body)
        
        let (data, _) = try await URLSession.shared.data(for: request)
        let response = try JSONDecoder().decode(CreateSchoolResponse.self, from: data)
        return response.school
    }
    
    // MARK: - åŸºç¡€å¯¹æ¯”
    func compareSchools(ids: [String]) async throws -> CompareResponse {
        guard let url = URL(string: "\(baseURL)/schools/compare") else {
            throw APIError.invalidURL
        }
        
        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        
        let body = ["schoolIds": ids]
        request.httpBody = try JSONEncoder().encode(body)
        
        let (data, _) = try await URLSession.shared.data(for: request)
        return try JSONDecoder().decode(CompareResponse.self, from: data)
    }
    
    // MARK: - æ ¹æ®æ•™è‚²é›†å›¢æŸ¥è¯¢å­¦æ ¡
    func getSchoolsByGroup(groupName: String) async throws -> SchoolsByGroupResponse {
        guard let encodedName = groupName.addingPercentEncoding(withAllowedCharacters: .urlPathAllowed),
              let url = URL(string: "\(baseURL)/schools/by-group/\(encodedName)") else {
            throw APIError.invalidURL
        }
        
        let (data, _) = try await URLSession.shared.data(from: url)
        return try JSONDecoder().decode(SchoolsByGroupResponse.self, from: data)
    }
    
    // MARK: - AIè¯„åˆ†å¯¹æ¯”ï¼ˆæ ‡å‡†ç‰ˆæœ¬ï¼‰
    func compareScoring(ids: [String]) async throws -> ScoringResponse {
        guard let url = URL(string: "\(baseURL)/schools/compare-scoring") else {
            throw APIError.invalidURL
        }
        
        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        
        let body = ["schoolIds": ids]
        request.httpBody = try JSONEncoder().encode(body)
        
        let (data, _) = try await URLSession.shared.data(for: request)
        return try JSONDecoder().decode(ScoringResponse.self, from: data)
    }
    
    // MARK: - AIè¯„åˆ†å¯¹æ¯”ï¼ˆæµå¼ç‰ˆæœ¬ï¼Œæ”¯æŒå®æ—¶è¿›åº¦ï¼‰
    func compareScoringStream(ids: [String], progressHandler: @escaping (EvaluationEvent) -> Void) async throws -> ScoringResponse {
        guard let url = URL(string: "\(baseURL)/schools/compare-scoring-stream") else {
            throw APIError.invalidURL
        }
        
        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")
        request.setValue("text/event-stream", forHTTPHeaderField: "Accept")
        
        let body = ["schoolIds": ids]
        request.httpBody = try JSONEncoder().encode(body)
        
        let (asyncBytes, _) = try await URLSession.shared.bytes(for: request)
        var buffer = ""
        var finalResponse: ScoringResponse?
        
        for try await line in asyncBytes.lines {
            if line.hasPrefix("data: ") {
                let jsonString = String(line.dropFirst(6))
                if let data = jsonString.data(using: .utf8),
                   let event = try? JSONDecoder().decode(EvaluationEvent.self, from: data) {
                    progressHandler(event)
                    
                    // å¦‚æœæ˜¯å®Œæˆäº‹ä»¶ï¼Œè§£ææœ€ç»ˆç»“æœ
                    if event.type == "complete", let eventData = event.data {
                        if let schools = eventData["schools"] as? [[String: Any]],
                           let scoring = eventData["scoring"] as? [String: Any] {
                            // è§£ææœ€ç»ˆå“åº”
                            // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æ ¹æ®å®é™…è¿”å›çš„æ•°æ®ç»“æ„è¿›è¡Œè§£æ
                            // ç¤ºä¾‹ä»£ç ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
                        }
                    }
                }
            }
        }
        
        guard let response = finalResponse else {
            throw APIError.invalidResponse
        }
        
        return response
    }
}

// è¯„ä¼°äº‹ä»¶æ¨¡å‹ï¼ˆç”¨äºæµå¼å“åº”ï¼‰
struct EvaluationEvent: Codable {
    let type: String // "start", "step", "thinking", "evaluating", "complete", "error"
    let message: String
    let timestamp: String?
    let data: [String: Any]?
    
    enum CodingKeys: String, CodingKey {
        case type, message, timestamp, data
    }
    
    init(from decoder: Decoder) throws {
        let container = try decoder.container(keyedBy: CodingKeys.self)
        type = try container.decode(String.self, forKey: .type)
        message = try container.decode(String.self, forKey: .message)
        timestamp = try container.decodeIfPresent(String.self, forKey: .timestamp)
        
        // å¤„ç†dataå­—æ®µï¼ˆå¯èƒ½æ˜¯å­—å…¸æˆ–nullï¼‰
        if let dataContainer = try? container.nestedContainer(keyedBy: DynamicCodingKeys.self, forKey: .data) {
            var dataDict: [String: Any] = [:]
            for key in dataContainer.allKeys {
                if let value = try? dataContainer.decode(String.self, forKey: key) {
                    dataDict[key.stringValue] = value
                } else if let value = try? dataContainer.decode(Int.self, forKey: key) {
                    dataDict[key.stringValue] = value
                } else if let value = try? dataContainer.decode(Double.self, forKey: key) {
                    dataDict[key.stringValue] = value
                }
                // å¯ä»¥æ·»åŠ æ›´å¤šç±»å‹æ”¯æŒ
            }
            data = dataDict.isEmpty ? nil : dataDict
        } else {
            data = nil
        }
    }
    
    struct DynamicCodingKeys: CodingKey {
        var stringValue: String
        init?(stringValue: String) {
            self.stringValue = stringValue
        }
        var intValue: Int?
        init?(intValue: Int) {
            return nil
        }
    }
}

enum APIError: Error {
    case invalidURL
    case invalidResponse
    case decodingError
}
```

### 3.4 UI å®ç°ï¼ˆSwiftUIï¼‰

#### 3.4.1 æœç´¢è§†å›¾

```swift
import SwiftUI

struct SearchView: View {
    @StateObject private var viewModel = SchoolViewModel()
    @State private var searchText = ""
    
    var body: some View {
        NavigationView {
            VStack(spacing: 20) {
                // æœç´¢æ¡†
                HStack {
                    TextField("æœç´¢å­¦æ ¡åç§°...", text: $searchText)
                        .textFieldStyle(RoundedBorderTextFieldStyle())
                        .onSubmit {
                            viewModel.search(query: searchText)
                        }
                    
                    Button("æœç´¢") {
                        viewModel.search(query: searchText)
                    }
                    .buttonStyle(.borderedProminent)
                }
                .padding()
                
                // å­¦æ ¡åˆ—è¡¨
                if viewModel.isLoading {
                    ProgressView("AI è¯„ä¼°ä¸­ï¼Œè¯·è€å¿ƒç­‰å€™...")
                } else if viewModel.schools.isEmpty {
                    EmptyStateView()
                } else {
                    SchoolListView(schools: viewModel.schools)
                }
            }
            .navigationTitle("School Insight")
        }
    }
}
```

#### 3.4.2 å­¦æ ¡åˆ—è¡¨è§†å›¾

```swift
struct SchoolListView: View {
    let schools: [School]
    @StateObject private var compareViewModel = CompareViewModel()
    
    var body: some View {
        ScrollView {
            LazyVGrid(columns: [GridItem(.adaptive(minimum: 300))], spacing: 20) {
                ForEach(schools) { school in
                    SchoolCard(school: school, isSelected: compareViewModel.isSelected(school))
                        .onTapGesture {
                            // æ˜¾ç¤ºè¯¦æƒ…
                        }
                }
            }
            .padding()
        }
        .overlay(alignment: .bottom) {
            if compareViewModel.hasSelection {
                CompareBar(viewModel: compareViewModel)
            }
        }
    }
}
```

#### 3.4.3 å¯¹æ¯”è§†å›¾

```swift
struct CompareView: View {
    let schools: [School]
    @State private var compareMode: CompareMode = .basic
    @State private var scoringData: ScoringData?
    
    enum CompareMode {
        case basic
        case scoring
    }
    
    var body: some View {
        VStack {
            Picker("å¯¹æ¯”æ¨¡å¼", selection: $compareMode) {
                Text("åŸºç¡€å¯¹æ¯”").tag(CompareMode.basic)
                Text("AIè¯„ä¼°").tag(CompareMode.scoring)
            }
            .pickerStyle(.segmented)
            .padding()
            
            if compareMode == .basic {
                BasicCompareTable(schools: schools)
            } else {
                if let scoring = scoringData {
                    ScoringCompareView(scoring: scoring, schools: schools)
                } else {
                    ProgressView("æ­£åœ¨ç”ŸæˆAIè¯„ä¼°...")
                        .onAppear {
                            loadScoring()
                        }
                }
            }
        }
    }
    
    private func loadScoring() {
        Task {
            let ids = schools.map { $0.id }
            do {
                let response = try await APIService.shared.compareScoring(ids: ids)
                scoringData = response.scoring
            } catch {
                // å¤„ç†é”™è¯¯
            }
        }
    }
}
```

### 3.5 ViewModel å®ç°

```swift
import SwiftUI
import Combine

class SchoolViewModel: ObservableObject {
    @Published var schools: [School] = []
    @Published var isLoading = false
    @Published var errorMessage: String?
    
    func search(query: String) {
        guard !query.isEmpty else { return }
        
        isLoading = true
        errorMessage = nil
        
        Task {
            do {
                let response = try await APIService.shared.searchSchools(query: query)
                await MainActor.run {
                    self.schools = response.schools
                    self.isLoading = false
                }
            } catch {
                await MainActor.run {
                    self.errorMessage = error.localizedDescription
                    self.isLoading = false
                }
            }
        }
    }
}

class CompareViewModel: ObservableObject {
    @Published var selectedSchools: Set<String> = []
    
    var hasSelection: Bool {
        !selectedSchools.isEmpty
    }
    
    func isSelected(_ school: School) -> Bool {
        selectedSchools.contains(school.id)
    }
    
    func toggleSelection(_ school: School) {
        if selectedSchools.contains(school.id) {
            selectedSchools.remove(school.id)
        } else {
            if selectedSchools.count < 3 {
                selectedSchools.insert(school.id)
            }
        }
    }
}
```

## å››ã€å…³é”®åŠŸèƒ½å®ç°è¦ç‚¹

### 4.1 å­¦æ ¡æœç´¢
- ä½¿ç”¨ `TextField` å®ç°æœç´¢è¾“å…¥
- è°ƒç”¨ `APIService.searchSchools()` è·å–ç»“æœ
- å¤„ç† `possibleSchoolNames` æƒ…å†µï¼ˆæ˜¾ç¤ºé€‰æ‹©ç•Œé¢ï¼‰
- **æ–°å¢**ï¼šæ”¯æŒç‚¹å‡»æ•™è‚²é›†å›¢åç§°è¿›è¡Œå…³è”æŸ¥è¯¢ï¼ˆè°ƒç”¨ `getSchoolsByGroup()`ï¼‰

### 4.2 å­¦æ ¡è¯¦æƒ…
- ä½¿ç”¨ `Sheet` æˆ– `NavigationLink` æ˜¾ç¤ºè¯¦æƒ…
- æŒ‰åˆ†ç±»å±•ç¤ºä¿¡æ¯ï¼ˆåŸºæœ¬ä¿¡æ¯ã€å­¦æ®µã€è¯¾ç¨‹ç­‰ï¼‰
- æ”¯æŒç½‘å€é“¾æ¥è·³è½¬
- **æ–°å¢**ï¼šæ˜¾ç¤º `schoolType`ï¼ˆå­¦æ ¡ç±»å‹ï¼‰å’Œ `affiliatedGroup`ï¼ˆéš¶å±æ•™è‚²é›†å›¢ï¼‰
- **æ–°å¢**ï¼šæ•™è‚²é›†å›¢å­—æ®µå¯ç‚¹å‡»ï¼Œè·³è½¬åˆ°è¯¥é›†å›¢ä¸‹çš„æ‰€æœ‰å­¦æ ¡åˆ—è¡¨
- **å…¼å®¹æ€§**ï¼šä¼˜å…ˆæ˜¾ç¤º `schoolType`ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ˜¾ç¤º `nature`ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰

### 4.3 å¤šå­¦æ ¡å¯¹æ¯”
- **åŸºç¡€å¯¹æ¯”**ï¼šä½¿ç”¨ `Table` æˆ–è‡ªå®šä¹‰è¡¨æ ¼è§†å›¾
- **AI è¯„åˆ†å¯¹æ¯”**ï¼š
  - **æ ‡å‡†ç‰ˆæœ¬**ï¼šè°ƒç”¨ `compareScoring()`ï¼Œç­‰å¾…å®Œæ•´ç»“æœè¿”å›
  - **æµå¼ç‰ˆæœ¬**ï¼šè°ƒç”¨ `compareScoringStream()`ï¼Œå®æ—¶æ˜¾ç¤ºè¯„ä¼°è¿›åº¦
    - æ˜¾ç¤ºè¯„ä¼°æ­¥éª¤ï¼ˆå¼€å§‹ã€æ£€æŸ¥ä¿¡æ¯ã€æ€è€ƒã€è¯„ä¼°å„æŒ‡æ ‡ç­‰ï¼‰
    - æ˜¾ç¤ºè¿›åº¦æ¡å’Œç™¾åˆ†æ¯”
    - æ˜¾ç¤ºå®æ—¶æ—¥å¿—
    - è¯„ä¼°å®Œæˆåæ˜¾ç¤ºå®Œæ•´ç»“æœ
  - æ˜¾ç¤ºé‡åŒ–å¯¹æ¯”è¡¨
  - æ˜¾ç¤ºæ€»åˆ†å’Œå„é¡¹å¾—åˆ†
  - æ˜¾ç¤ºè¯„åˆ†è¯´æ˜å’Œæ€»ç»“
  - **æ–°å¢**ï¼šæ˜¾ç¤ºè¯„åˆ†è­¦å‘Šï¼ˆå¦‚å­¦æ ¡æ€§è´¨ä¸ä¸€è‡´æ—¶çš„æç¤ºï¼‰
  - ä½¿ç”¨å›¾è¡¨å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

### 4.4 çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ `@StateObject` å’Œ `@ObservedObject` ç®¡ç†çŠ¶æ€
- ä½¿ç”¨ `Combine` å¤„ç†å¼‚æ­¥æ“ä½œ
- ç¼“å­˜å¯¹æ¯”æ•°æ®ä»¥æé«˜æ€§èƒ½
- **æ–°å¢**ï¼šç®¡ç†æµå¼è¯„ä¼°è¿›åº¦çŠ¶æ€ï¼ˆå½“å‰æ­¥éª¤ã€è¿›åº¦ç™¾åˆ†æ¯”ã€æ—¥å¿—ç­‰ï¼‰

### 4.5 æµå¼AIè¯„ä¼°å®ç°è¦ç‚¹

æµå¼AIè¯„ä¼°ä½¿ç”¨ Server-Sent Events (SSE) åè®®ï¼Œå®æ—¶æ¨é€è¯„ä¼°è¿›åº¦ã€‚å®ç°è¦ç‚¹ï¼š

1. **SSE è¿æ¥è®¾ç½®**
   - ä½¿ç”¨ `URLSession.bytes(for:)` æ–¹æ³•å»ºç«‹æµå¼è¿æ¥
   - è®¾ç½®è¯·æ±‚å¤´ï¼š`Accept: text/event-stream`
   - è®¾ç½®å“åº”å¤´å¤„ç†ï¼š`Content-Type: text/event-stream`

2. **äº‹ä»¶è§£æ**
   - SSE äº‹ä»¶æ ¼å¼ï¼š`data: {JSONå¯¹è±¡}\n\n`
   - é€è¡Œè¯»å–å¹¶è§£æ JSON äº‹ä»¶
   - äº‹ä»¶ç±»å‹åŒ…æ‹¬ï¼š
     - `start`: è¯„ä¼°å¼€å§‹
     - `step`: è¯„ä¼°æ­¥éª¤ï¼ˆå¦‚æ£€æŸ¥ä¿¡æ¯å®Œæ•´æ€§ï¼‰
     - `thinking`: AI æ€è€ƒé˜¶æ®µ
     - `evaluating`: æ­£åœ¨è¯„ä¼°æŸä¸ªæŒ‡æ ‡ï¼ˆåŒ…å«è¿›åº¦ä¿¡æ¯ï¼‰
     - `complete`: è¯„ä¼°å®Œæˆï¼ˆåŒ…å«æœ€ç»ˆç»“æœï¼‰
     - `error`: è¯„ä¼°å‡ºé”™

3. **è¿›åº¦æ›´æ–°**
   - æ ¹æ®äº‹ä»¶ç±»å‹æ›´æ–°è¿›åº¦æ¡ï¼ˆ0-100%ï¼‰
   - æ˜¾ç¤ºå½“å‰è¯„ä¼°æ­¥éª¤æ–‡æœ¬
   - è®°å½•å¹¶æ˜¾ç¤ºå®æ—¶æ—¥å¿—
   - æ˜¾ç¤ºè¯„ä¼°è€—æ—¶ï¼ˆè®¡æ—¶å™¨ï¼‰

4. **ç»“æœå¤„ç†**
   - åœ¨ `complete` äº‹ä»¶ä¸­è§£æ `data.schools` å’Œ `data.scoring`
   - è§£æ `data.warning`ï¼ˆå¦‚æœæœ‰è­¦å‘Šï¼‰
   - æ›´æ–°UIæ˜¾ç¤ºæœ€ç»ˆå¯¹æ¯”ç»“æœ

5. **é”™è¯¯å¤„ç†**
   - ç›‘å¬ `error` äº‹ä»¶
   - å¤„ç†ç½‘ç»œä¸­æ–­
   - å¤„ç†è¶…æ—¶æƒ…å†µ
   - æä¾›é‡è¯•æœºåˆ¶

**ç¤ºä¾‹ä»£ç ç»“æ„**ï¼š
```swift
// åœ¨ ViewModel ä¸­
@Published var evaluationProgress: Double = 0
@Published var evaluationStep: String = ""
@Published var evaluationLogs: [String] = []

func startScoringStream(ids: [String]) async {
    do {
        try await APIService.shared.compareScoringStream(ids: ids) { event in
            DispatchQueue.main.async {
                switch event.type {
                case "start":
                    self.evaluationStep = event.message
                    self.evaluationProgress = 10
                case "step":
                    self.evaluationStep = event.message
                    self.evaluationProgress = 30
                case "thinking":
                    self.evaluationStep = event.message
                    self.evaluationProgress = 50
                case "evaluating":
                    self.evaluationStep = event.message
                    if let progress = event.data?["progress"] as? String {
                        // è§£æè¿›åº¦ "1/10" æ ¼å¼
                        // æ›´æ–°è¿›åº¦æ¡
                    }
                case "complete":
                    self.evaluationProgress = 100
                    // è§£ææœ€ç»ˆç»“æœ
                case "error":
                    // æ˜¾ç¤ºé”™è¯¯
                default:
                    break
                }
                // æ·»åŠ æ—¥å¿—
                if let timestamp = event.timestamp {
                    self.evaluationLogs.append("[\(timestamp)] \(event.message)")
                }
            }
        }
    } catch {
        // å¤„ç†é”™è¯¯
    }
}
```

## äº”ã€UI/UX è®¾è®¡å»ºè®®

### 5.1 è®¾è®¡é£æ ¼
- å‚è€ƒ Web ç‰ˆæœ¬çš„é…è‰²æ–¹æ¡ˆï¼ˆä¸»è‰²ï¼š#F75C62ï¼‰
- ä½¿ç”¨ iOS åŸç”Ÿè®¾è®¡è¯­è¨€ï¼ˆSF Symbolsã€ç³»ç»Ÿå­—ä½“ï¼‰
- ä¿æŒå“åº”å¼å¸ƒå±€

### 5.2 äº¤äº’ä¼˜åŒ–
- ä½¿ç”¨ `PullToRefresh` å®ç°ä¸‹æ‹‰åˆ·æ–°
- ä½¿ç”¨ `LazyVStack` æˆ– `LazyVGrid` ä¼˜åŒ–åˆ—è¡¨æ€§èƒ½
- æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯æç¤º
- æ”¯æŒæ·±è‰²æ¨¡å¼

### 5.3 åŠ¨ç”»æ•ˆæœ
- ä½¿ç”¨ SwiftUI çš„ `animation` ä¿®é¥°ç¬¦
- å¡ç‰‡ç‚¹å‡»åŠ¨ç”»
- é¡µé¢è½¬åœºåŠ¨ç”»

## å…­ã€æ•°æ®æŒä¹…åŒ–ï¼ˆå¯é€‰ï¼‰

### 6.1 æœ¬åœ°ç¼“å­˜
- ä½¿ç”¨ `UserDefaults` å­˜å‚¨æœç´¢å†å²
- ä½¿ç”¨ `Core Data` æˆ– `SwiftData` ç¼“å­˜å­¦æ ¡æ•°æ®
- å®ç°ç¦»çº¿æŸ¥çœ‹åŠŸèƒ½

### 6.2 æ”¶è—åŠŸèƒ½
- å…è®¸ç”¨æˆ·æ”¶è—å­¦æ ¡
- æœ¬åœ°å­˜å‚¨æ”¶è—åˆ—è¡¨

## ä¸ƒã€æµ‹è¯•è¦ç‚¹

### 7.1 åŠŸèƒ½æµ‹è¯•
- æœç´¢åŠŸèƒ½
- å­¦æ ¡è¯¦æƒ…å±•ç¤º
- å¯¹æ¯”åŠŸèƒ½ï¼ˆåŸºç¡€/AIï¼‰
- é”™è¯¯å¤„ç†

### 7.2 æ€§èƒ½æµ‹è¯•
- å¤§é‡æ•°æ®åŠ è½½
- ç½‘ç»œè¯·æ±‚ä¼˜åŒ–
- å†…å­˜ç®¡ç†

### 7.3 UI æµ‹è¯•
- ä¸åŒå±å¹•å°ºå¯¸é€‚é…
- æ·±è‰²æ¨¡å¼æµ‹è¯•
- æ— éšœç¢åŠŸèƒ½

## å…«ã€éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 8.1 API é…ç½®
- ç¡®ä¿åç«¯ API æ”¯æŒ CORSï¼ˆå¦‚æœè·¨åŸŸï¼‰
- é…ç½®æ­£ç¡®çš„ API åŸºç¡€ URL
- å¤„ç† API é”™è¯¯å’Œè¶…æ—¶

### 8.2 ç½‘ç»œæƒé™
- åœ¨ `Info.plist` ä¸­é…ç½®ç½‘ç»œæƒé™
- å¤„ç†ç½‘ç»œä¸å¯ç”¨æƒ…å†µ

### 8.3 ç‰ˆæœ¬ç®¡ç†
- ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶
- éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬å·

## ä¹ã€å‚è€ƒèµ„æº

### 9.1 ç›¸å…³ä»£ç æ–‡ä»¶ä½ç½®ï¼ˆå¯ç›´æ¥æŸ¥çœ‹å‚è€ƒï¼‰

ä»¥ä¸‹æ–‡ä»¶è·¯å¾„åŸºäºé¡¹ç›®æ ¹ç›®å½•ï¼ŒXcode ç¨‹åºå‘˜å¯ä»¥ç›´æ¥æŸ¥çœ‹è¿™äº›æ–‡ä»¶æ¥ç†è§£å…·ä½“å®ç°ï¼š

#### å‰ç«¯ä»£ç æ–‡ä»¶
- **å‰ç«¯ HTML**ï¼š`schoolinsight.html`
  - å®Œæ•´çš„ UI ç»“æ„å’Œæ ·å¼å®šä¹‰
  - æœç´¢æ¡†ã€å­¦æ ¡å¡ç‰‡ã€å¯¹æ¯”è§†å›¾ã€å¼¹çª—ç­‰ç»„ä»¶
  
- **å‰ç«¯ JavaScript**ï¼š`js/schoolinsight.js`
  - ç¬¬ 1-158 è¡Œï¼šçŠ¶æ€ç®¡ç†å’Œåˆå§‹åŒ–
  - ç¬¬ 159-288 è¡Œï¼šå­¦æ ¡æœç´¢å’ŒåŠ è½½é€»è¾‘
  - ç¬¬ 290-402 è¡Œï¼šå­¦æ ¡åˆ—è¡¨æ¸²æŸ“å’Œé€‰æ‹©ç®¡ç†
  - ç¬¬ 404-478 è¡Œï¼šåŸºç¡€å¯¹æ¯”å’Œ AI è¯„åˆ†å¯¹æ¯”å¤„ç†
  - ç¬¬ 480-569 è¡Œï¼šå¯¹æ¯”è¡¨æ ¼æ¸²æŸ“
  - ç¬¬ 571-702 è¡Œï¼šAI è¯„åˆ†å¯¹æ¯”ç»“æœæ¸²æŸ“
  - ç¬¬ 869-1001 è¡Œï¼š**æµå¼ AI è¯„ä¼°å®ç°**ï¼ˆ`handleCompareScoringStream` å‡½æ•°ï¼‰
  - ç¬¬ 1058-1280 è¡Œï¼šå­¦æ ¡è¯¦æƒ…å¼¹çª—å’Œæ•™è‚²é›†å›¢æŸ¥è¯¢

#### åç«¯ä»£ç æ–‡ä»¶
- **åç«¯ API æœåŠ¡å™¨**ï¼š`server.js`
  - ç¬¬ 39-91 è¡Œï¼š**æ•°æ®æ¨¡å‹å®šä¹‰**ï¼ˆSchoolSchemaï¼ŒåŒ…å« schoolType å’Œ affiliatedGroupï¼‰
  - ç¬¬ 254-395 è¡Œï¼šå­¦æ ¡åˆ—è¡¨å’Œæœç´¢ APIï¼ˆ`GET /api/schools`ï¼‰
  - ç¬¬ 360-395 è¡Œï¼š**æ ¹æ®æ•™è‚²é›†å›¢æŸ¥è¯¢**ï¼ˆ`GET /api/schools/by-group/:groupName`ï¼‰
  - ç¬¬ 397-425 è¡Œï¼šè·å–å•ä¸ªå­¦æ ¡è¯¦æƒ…ï¼ˆ`GET /api/schools/:id`ï¼‰
  - ç¬¬ 427-478 è¡Œï¼šæ ¹æ®åç§°åˆ›å»ºå­¦æ ¡ï¼ˆ`POST /api/schools/create-from-name`ï¼‰
  - ç¬¬ 483-506 è¡Œï¼šåŸºç¡€å¯¹æ¯”ï¼ˆ`POST /api/schools/compare`ï¼‰
  - ç¬¬ 1132-1350 è¡Œï¼š**æµå¼ AI è¯„åˆ†å¯¹æ¯”**ï¼ˆ`POST /api/schools/compare-scoring-stream`ï¼‰
    - ç¬¬ 1139-1147 è¡Œï¼šSSE äº‹ä»¶å‘é€å‡½æ•°
    - ç¬¬ 1174-1230 è¡Œï¼šåŸºç¡€ä¿¡æ¯å®Œæ•´æ€§æ£€æŸ¥
    - ç¬¬ 1232-1258 è¡Œï¼šAI è¯„ä¼°è°ƒç”¨å’Œæµå¼å¤„ç†
  - ç¬¬ 1353-1636 è¡Œï¼šæ ‡å‡† AI è¯„åˆ†å¯¹æ¯”ï¼ˆ`POST /api/schools/compare-scoring`ï¼‰
  - ç¬¬ 1958-2031 è¡Œï¼š**å­¦æ ¡ç±»å‹ç»Ÿä¸€åŒ–å‡½æ•°**ï¼ˆ`unifyNature`ï¼Œnature åˆ° schoolType çš„è½¬æ¢é€»è¾‘ï¼‰

#### æ•°æ®è¿ç§»å’Œå·¥å…·è„šæœ¬
- **æ•°æ®åº“è¿ç§»è„šæœ¬**ï¼š`migrate-nature-to-schooltype.js`
  - å°†æ—§çš„ `nature` å­—æ®µè¿ç§»åˆ°æ–°çš„ `schoolType` å­—æ®µ
  
- **å­¦æ ¡ç±»å‹ç»Ÿä¸€è„šæœ¬**ï¼š`unify-school-nature.js`
  - ç»Ÿä¸€å­¦æ ¡ç±»å‹å­—æ®µçš„æ ¼å¼å’Œåˆ†ç±»

#### è¯„ä¼°ç³»ç»Ÿ
- **è¯„ä¼°ä½“ç³»å®šä¹‰**ï¼š`evaluation-system.js`
  - AI è¯„ä¼°çš„æŒ‡æ ‡å®šä¹‰ã€æƒé‡åˆ†é…ã€è¯„åˆ†è§„åˆ™ç­‰

#### API æ–‡æ¡£
- **API æ¥å£æ¸…å•**ï¼š`SchoolInsight-APIæ¥å£æ¸…å•.md`
  - æ‰€æœ‰ API æ¥å£çš„è¯¦ç»†è¯´æ˜ã€è¯·æ±‚å‚æ•°ã€å“åº”æ ¼å¼ç­‰

### 9.2 å…³é”®ä»£ç ç‰‡æ®µä½ç½®

#### æ•°æ®æ¨¡å‹ç›¸å…³
- **School æ¨¡å‹å®šä¹‰**ï¼š`server.js` ç¬¬ 40-89 è¡Œ
- **å­—æ®µæ˜ å°„ç¤ºä¾‹**ï¼š`sync-school-data.js` ç¬¬ 44-90 è¡Œï¼ˆCSV å­—æ®µåˆ°æ•°æ®åº“å­—æ®µçš„æ˜ å°„ï¼‰

#### æµå¼è¯„ä¼°ç›¸å…³
- **å‰ç«¯æµå¼å¤„ç†**ï¼š`js/schoolinsight.js` ç¬¬ 869-1001 è¡Œ
  - `handleCompareScoringStream()` å‡½æ•°ï¼šå®Œæ•´çš„æµå¼å¤„ç†å®ç°
  - `handleEvaluationEvent()` å‡½æ•°ï¼šäº‹ä»¶å¤„ç†é€»è¾‘
  - `appendEvaluationLiveLog()` å‡½æ•°ï¼šå®æ—¶æ—¥å¿—è¿½åŠ 
  
- **åç«¯ SSE å®ç°**ï¼š`server.js` ç¬¬ 1132-1350 è¡Œ
  - SSE å“åº”å¤´è®¾ç½®
  - äº‹ä»¶å‘é€å‡½æ•° `sendProgress()`
  - æµå¼è¯„ä¼°æµç¨‹

#### æ•™è‚²é›†å›¢æŸ¥è¯¢ç›¸å…³
- **å‰ç«¯å®ç°**ï¼š`js/schoolinsight.js` ç¬¬ 1238-1280 è¡Œ
  - `loadSchoolsByGroup()` å‡½æ•°ï¼šæ ¹æ®æ•™è‚²é›†å›¢åŠ è½½å­¦æ ¡åˆ—è¡¨
  - æ•™è‚²é›†å›¢é“¾æ¥ç‚¹å‡»äº‹ä»¶å¤„ç†
  
- **åç«¯å®ç°**ï¼š`server.js` ç¬¬ 360-395 è¡Œ
  - `GET /api/schools/by-group/:groupName` è·¯ç”±å¤„ç†

#### å­¦æ ¡ç±»å‹å…¼å®¹æ€§å¤„ç†
- **å‰ç«¯å…¼å®¹å¤„ç†**ï¼š`js/schoolinsight.js` ç¬¬ 1108-1110 è¡Œã€ç¬¬ 1172-1174 è¡Œã€ç¬¬ 1186-1189 è¡Œ
  - ä¼˜å…ˆä½¿ç”¨ `schoolType`ï¼Œä¸å­˜åœ¨åˆ™ä½¿ç”¨ `nature`
  
- **åç«¯å…¼å®¹å¤„ç†**ï¼š`server.js` ç¬¬ 576-577 è¡Œã€ç¬¬ 591 è¡Œã€ç¬¬ 1671 è¡Œã€ç¬¬ 1880 è¡Œ
  - å¤šå¤„ä½¿ç”¨ `school.schoolType || school.nature` çš„å…¼å®¹å†™æ³•

### 9.2 å¿«é€Ÿå‚è€ƒï¼šå…³é”®ä»£ç æ–‡ä»¶æ¸…å•

**å»ºè®® Xcode ç¨‹åºå‘˜æŒ‰ä»¥ä¸‹é¡ºåºæŸ¥çœ‹ä»£ç æ–‡ä»¶ï¼š**

1. **é¦–å…ˆæŸ¥çœ‹æ•°æ®æ¨¡å‹**ï¼ˆäº†è§£æ•°æ®ç»“æ„ï¼‰
   ```
   server.js (ç¬¬ 40-89 è¡Œ) - School æ•°æ®æ¨¡å‹å®šä¹‰
   ```

2. **æŸ¥çœ‹ API æ¥å£å®ç°**ï¼ˆäº†è§£æ¥å£è§„èŒƒï¼‰
   ```
   server.js (ç¬¬ 254-395 è¡Œ) - å­¦æ ¡æœç´¢å’Œåˆ—è¡¨ API
   server.js (ç¬¬ 360-395 è¡Œ) - æ•™è‚²é›†å›¢æŸ¥è¯¢ API
   server.js (ç¬¬ 1132-1350 è¡Œ) - æµå¼ AI è¯„åˆ†å¯¹æ¯” API
   server.js (ç¬¬ 1353-1636 è¡Œ) - æ ‡å‡† AI è¯„åˆ†å¯¹æ¯” API
   ```

3. **æŸ¥çœ‹å‰ç«¯å®ç°**ï¼ˆäº†è§£äº¤äº’é€»è¾‘ï¼‰
   ```
   js/schoolinsight.js (ç¬¬ 869-1001 è¡Œ) - æµå¼è¯„ä¼°å‰ç«¯å®ç°
   js/schoolinsight.js (ç¬¬ 1238-1280 è¡Œ) - æ•™è‚²é›†å›¢æŸ¥è¯¢å‰ç«¯å®ç°
   js/schoolinsight.js (ç¬¬ 1108-1236 è¡Œ) - å­¦æ ¡è¯¦æƒ…å±•ç¤ºï¼ˆåŒ…å«å­—æ®µå…¼å®¹å¤„ç†ï¼‰
   ```

4. **æŸ¥çœ‹ API æ–‡æ¡£**ï¼ˆäº†è§£æ¥å£è§„èŒƒï¼‰
   ```
   SchoolInsight-APIæ¥å£æ¸…å•.md - å®Œæ•´çš„ API æ¥å£æ–‡æ¡£
   ```

### 9.3 å­¦ä¹ èµ„æº
- SwiftUI å®˜æ–¹æ–‡æ¡£
- Combine æ¡†æ¶æ–‡æ¡£
- URLSession ç½‘ç»œç¼–ç¨‹
- Core Data / SwiftData æ•°æ®æŒä¹…åŒ–
- Server-Sent Events (SSE) åè®®æ–‡æ¡£

## åã€è¿ç§»æ£€æŸ¥æ¸…å•

### åŸºç¡€åŠŸèƒ½
- [ ] åˆ›å»º Xcode é¡¹ç›®
- [ ] å®ç°æ•°æ®æ¨¡å‹ï¼ˆSchoolã€ScoringData ç­‰ï¼‰
  - [ ] æ·»åŠ  `schoolType` å­—æ®µ
  - [ ] æ·»åŠ  `affiliatedGroup` å­—æ®µ
  - [ ] å®ç° `displaySchoolType` è®¡ç®—å±æ€§ï¼ˆå…¼å®¹ `nature`ï¼‰
- [ ] å®ç° API æœåŠ¡å±‚
  - [ ] å®ç°åŸºç¡€ APIï¼ˆæœç´¢ã€è¯¦æƒ…ã€å¯¹æ¯”ï¼‰
  - [ ] å®ç° `getSchoolsByGroup()` æ–¹æ³•
  - [ ] å®ç° `compareScoring()` æ ‡å‡†ç‰ˆæœ¬
  - [ ] å®ç° `compareScoringStream()` æµå¼ç‰ˆæœ¬
- [ ] å®ç°æœç´¢è§†å›¾
- [ ] å®ç°å­¦æ ¡åˆ—è¡¨è§†å›¾
- [ ] å®ç°å­¦æ ¡è¯¦æƒ…è§†å›¾
  - [ ] æ˜¾ç¤º `schoolType` å’Œ `affiliatedGroup`
  - [ ] å®ç°æ•™è‚²é›†å›¢åç§°ç‚¹å‡»è·³è½¬
- [ ] å®ç°åŸºç¡€å¯¹æ¯”è§†å›¾
- [ ] å®ç° AI è¯„åˆ†å¯¹æ¯”è§†å›¾
  - [ ] æ ‡å‡†ç‰ˆæœ¬ï¼ˆç­‰å¾…å®Œæ•´ç»“æœï¼‰
  - [ ] æµå¼ç‰ˆæœ¬ï¼ˆå®æ—¶è¿›åº¦æ˜¾ç¤ºï¼‰
  - [ ] æ˜¾ç¤ºè¯„åˆ†è­¦å‘Šä¿¡æ¯

### é«˜çº§åŠŸèƒ½
- [ ] å®ç°æµå¼è¯„ä¼°è¿›åº¦UI
  - [ ] è¿›åº¦æ¡å’Œç™¾åˆ†æ¯”æ˜¾ç¤º
  - [ ] å½“å‰æ­¥éª¤æ–‡æœ¬æ˜¾ç¤º
  - [ ] å®æ—¶æ—¥å¿—æ˜¾ç¤º
  - [ ] è¯„ä¼°è®¡æ—¶å™¨
- [ ] å®ç°çŠ¶æ€ç®¡ç†ï¼ˆViewModelï¼‰
- [ ] æ·»åŠ é”™è¯¯å¤„ç†
- [ ] æ·»åŠ åŠ è½½çŠ¶æ€
- [ ] UI/UX ä¼˜åŒ–
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
  - [ ] æµ‹è¯•æ–°æ—§å­—æ®µå…¼å®¹æ€§
  - [ ] æµ‹è¯•æµå¼è¯„ä¼°åŠŸèƒ½
  - [ ] æµ‹è¯•æ•™è‚²é›†å›¢å…³è”æŸ¥è¯¢
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å‡†å¤‡å‘å¸ƒ

## åä¸€ã€å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¤„ç†ä¸­æ–‡å­—æ®µåï¼Ÿ
A: ä½¿ç”¨ `CodingKeys` æšä¸¾æ˜ å°„ä¸­æ–‡å­—æ®µååˆ° Swift å±æ€§åã€‚

### Q2: AI è¯„ä¼°æ•°æ®æ ¼å¼å¤æ‚ï¼Œå¦‚ä½•è§£æï¼Ÿ
A: åˆ›å»ºå¯¹åº”çš„ `Codable` ç»“æ„ä½“ï¼Œé€å±‚è§£æ JSON æ•°æ®ã€‚

### Q3: å¦‚ä½•ä¼˜åŒ–å¤§é‡å­¦æ ¡æ•°æ®çš„å±•ç¤ºï¼Ÿ
A: ä½¿ç”¨ `LazyVStack`/`LazyVGrid`ï¼Œå®ç°åˆ†é¡µåŠ è½½ï¼Œæ·»åŠ æœ¬åœ°ç¼“å­˜ã€‚

### Q4: å¯¹æ¯”è¡¨æ ¼åœ¨ iOS ä¸Šå¦‚ä½•å®ç°ï¼Ÿ
A: ä½¿ç”¨ SwiftUI çš„ `Table`ï¼ˆiOS 16+ï¼‰æˆ–è‡ªå®šä¹‰ `VStack`/`HStack` å¸ƒå±€ã€‚

### Q5: å¦‚ä½•å®ç°æµå¼AIè¯„ä¼°è¿›åº¦æ˜¾ç¤ºï¼Ÿ
A: ä½¿ç”¨ `URLSession.bytes(for:)` å¤„ç† SSE æµï¼Œé€è¡Œè§£æäº‹ä»¶å¹¶æ›´æ–°UIã€‚å‚è€ƒ `compareScoringStream()` æ–¹æ³•çš„å®ç°ã€‚

### Q6: `schoolType` å’Œ `nature` å­—æ®µæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
A: `schoolType` æ˜¯æ–°å­—æ®µï¼Œç»Ÿä¸€äº†å­¦æ ¡ç±»å‹çš„åˆ†ç±»æ ‡å‡†ï¼ˆå››ç§æ ‡å‡†ç±»å‹ï¼š`"å…¬ç«‹å­¦æ ¡"`ã€`"æ™®é€šæ°‘åŠå­¦æ ¡"`ã€`"æ°‘åŠåŒè¯­å­¦æ ¡"`ã€`"å…¬ç«‹å­¦æ ¡ï¼ˆå›½é™…éƒ¨ï¼‰"`ï¼‰ã€‚`nature` æ˜¯æ—§å­—æ®µï¼Œä¿ç•™ä»¥å…¼å®¹æ—§æ•°æ®ã€‚å»ºè®®ä¼˜å…ˆä½¿ç”¨ `schoolType`ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™å›é€€åˆ° `nature`ã€‚åœ¨ Swift æ¨¡å‹ä¸­å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§ `displaySchoolType` æ¥ç»Ÿä¸€å¤„ç†ã€‚

### Q7: å¦‚ä½•å®ç°æ•™è‚²é›†å›¢å…³è”æŸ¥è¯¢ï¼Ÿ
A: åœ¨å­¦æ ¡è¯¦æƒ…é¡µé¢ï¼Œå°† `affiliatedGroup` å­—æ®µæ˜¾ç¤ºä¸ºå¯ç‚¹å‡»é“¾æ¥ï¼Œç‚¹å‡»åè°ƒç”¨ `getSchoolsByGroup(groupName:)` æ¥å£ï¼Œè·³è½¬åˆ°è¯¥é›†å›¢ä¸‹çš„å­¦æ ¡åˆ—è¡¨ã€‚

### Q8: æµå¼è¯„ä¼°å’Œæ ‡å‡†è¯„ä¼°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåº”è¯¥ä½¿ç”¨å“ªä¸ªï¼Ÿ
A: 
- **æ ‡å‡†è¯„ä¼°** (`compare-scoring`)ï¼šç­‰å¾…å®Œæ•´ç»“æœè¿”å›ï¼Œé€‚åˆä¸éœ€è¦å®æ—¶åé¦ˆçš„åœºæ™¯ï¼Œå®ç°ç®€å•
- **æµå¼è¯„ä¼°** (`compare-scoring-stream`)ï¼šå®æ—¶æ˜¾ç¤ºè¯„ä¼°è¿›åº¦ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ï¼Œä½†å®ç°è¾ƒå¤æ‚
- **å»ºè®®**ï¼šä¼˜å…ˆä½¿ç”¨æµå¼è¯„ä¼°ï¼Œå¦‚æœæµå¼è¯„ä¼°å¤±è´¥åˆ™å›é€€åˆ°æ ‡å‡†è¯„ä¼°

### Q7: å¦‚ä½•å®ç°æ•™è‚²é›†å›¢å…³è”æŸ¥è¯¢ï¼Ÿ
A: åœ¨å­¦æ ¡è¯¦æƒ…é¡µé¢ï¼Œå°† `affiliatedGroup` å­—æ®µæ˜¾ç¤ºä¸ºå¯ç‚¹å‡»é“¾æ¥ï¼Œç‚¹å‡»åè°ƒç”¨ `getSchoolsByGroup(groupName:)` æ¥å£ï¼Œè·³è½¬åˆ°è¯¥é›†å›¢ä¸‹çš„å­¦æ ¡åˆ—è¡¨ã€‚

---

## åäºŒã€æœ€æ–°æ›´æ–°ï¼ˆ2025-01ï¼‰

### 12.1 æ•°æ®åº“å­—æ®µæ›´æ–°
- âœ… æ–°å¢ `schoolType` å­—æ®µï¼ˆå­¦æ ¡ç±»å‹ï¼‰
- âœ… æ–°å¢ `affiliatedGroup` å­—æ®µï¼ˆéš¶å±æ•™è‚²é›†å›¢ï¼‰
- âœ… ä¿ç•™ `nature` å­—æ®µä»¥å…¼å®¹æ—§æ•°æ®

### 12.2 API æ¥å£æ›´æ–°
- âœ… æ–°å¢ `/api/schools/compare-scoring-stream` æµå¼AIè¯„åˆ†å¯¹æ¯”æ¥å£
- âœ… æ–°å¢ `/api/schools/by-group/:groupName` æ ¹æ®æ•™è‚²é›†å›¢æŸ¥è¯¢æ¥å£
- âœ… AIè¯„åˆ†å¯¹æ¯”å“åº”æ–°å¢ `warning` å­—æ®µï¼ˆå­¦æ ¡æ€§è´¨ä¸ä¸€è‡´è­¦å‘Šï¼‰

### 12.3 åŠŸèƒ½ä¼˜åŒ–
- âœ… AIè¯„ä¼°æ”¯æŒæµå¼è¾“å‡ºï¼Œå®æ—¶æ˜¾ç¤ºè¯„ä¼°è¿›åº¦
- âœ… å­¦æ ¡è¯¦æƒ…é¡µé¢æ”¯æŒç‚¹å‡»æ•™è‚²é›†å›¢åç§°è¿›è¡Œå…³è”æŸ¥è¯¢
- âœ… å¢åŠ å­¦æ ¡æ€§è´¨ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¯¹æ¯”æ—¶æç¤ºç”¨æˆ·

---

**æ³¨æ„**ï¼šæœ¬æ–‡æ¡£ä»…æä¾›è¿ç§»æŒ‡å¯¼ï¼Œä¸ä¿®æ”¹ç°æœ‰ä»£ç ã€‚æ‰€æœ‰ä»£ç ç¤ºä¾‹ä»…ä¾›å‚è€ƒï¼Œéœ€è¦æ ¹æ®å®é™…é¡¹ç›®éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚

**æœ€åæ›´æ–°æ—¥æœŸ**ï¼š2026-01-05

