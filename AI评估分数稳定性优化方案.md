# AI评估分数稳定性优化方案

## 问题分析

### 当前问题
当对比学校不同时，同一所学校的AI评估分数会出现变化。这是因为：
1. **相对评估机制**：AI在对比时会进行相对评分，而不是绝对评分
2. **缺乏评分基准**：没有固定的评分标准参考
3. **无历史分数聚合**：每次都是全新评估，没有利用历史数据

### 影响
- 同一所学校在不同对比组合中分数不一致
- 用户对评估结果的可信度降低
- 难以进行跨组合的学校排名

## 解决方案

### 方案1：绝对评分机制（核心方案）

**原理**：要求AI基于评估体系进行绝对评分，而不是相对对比评分。

**实现方式**：
1. 优化提示词，明确要求"绝对评分"
2. 强调基于评估标准的客观评分，而非对比评分
3. 要求AI参考行业标准，而非当前对比组

**优点**：
- 直接解决根本问题
- 实现简单，只需修改提示词
- 不增加系统复杂度

**缺点**：
- 依赖AI模型的理解能力
- 可能需要多次调优提示词

### 方案2：历史分数聚合（推荐配合方案1）

**原理**：保存历史评估分数，使用加权平均或中位数来稳定分数。

**实现方式**：
1. 在数据库中保存历史评估记录
2. 计算加权平均分数（新评估权重更高）
3. 使用聚合分数作为最终显示分数

**优点**：
- 分数会随着评估次数增加而趋于稳定
- 减少单次评估的随机性
- 提高评估结果的可信度

**缺点**：
- 需要修改数据库结构
- 需要实现聚合逻辑
- 首次评估时仍可能有波动

### 方案3：参考学校池（可选方案）

**原理**：建立标准参考学校池，每次评估时都包含这些参考学校作为基准。

**实现方式**：
1. 选择3-5所不同类型的标杆学校
2. 每次评估时自动加入这些参考学校
3. AI基于参考学校进行相对评分，然后标准化

**优点**：
- 提供稳定的评分基准
- 可以标准化不同评估的分数

**缺点**：
- 增加评估成本（每次评估更多学校）
- 需要维护参考学校池
- 实现复杂度较高

### 方案4：分数标准化（配合方案）

**原理**：使用统计方法（如z-score）标准化分数，减少对比学校的影响。

**实现方式**：
1. 计算当前对比组的平均分和标准差
2. 使用z-score标准化
3. 映射回0-100分区间

**优点**：
- 可以减少对比组的影响
- 数学方法可靠

**缺点**：
- 需要足够多的对比学校
- 可能过度标准化，失去绝对意义

## 推荐实施方案

### 阶段1：立即实施（方案1）
- 优化提示词，强调绝对评分
- 明确要求基于评估标准，而非对比组

### 阶段2：短期优化（方案1 + 方案2）
- 实现历史分数聚合机制
- 使用加权平均稳定分数
- 显示"评估次数"和"分数稳定性"

### 阶段3：长期优化（可选）
- 如果前两个方案效果不佳，考虑方案3或方案4

## 具体实现建议

### 1. 提示词优化要点

在 `buildScoringPrompt` 函数中添加：

```
**重要评分原则：**
1. **绝对评分，非相对评分**：请基于评估体系的标准对每所学校进行独立、客观的绝对评分，而不是根据对比学校进行相对评分。每所学校的分数应该反映其在评估标准下的真实水平，而不是相对于其他对比学校的水平。

2. **评分基准**：请参考行业标准和评估体系中的评分标准，而不是当前对比组的平均水平。例如：
   - 如果学校A在"课程与融合"方面达到5分制标准中的4分水平，应该给予相应的绝对分数（如12分/15分），无论对比学校B的水平如何。
   - 不要因为对比学校B水平较低，就提高学校A的分数；也不要因为对比学校B水平较高，就降低学校A的分数。

3. **一致性要求**：同一所学校在不同对比组合中，如果其实际水平没有变化，应该得到相同或非常接近的分数（允许±1分的合理误差）。
```

### 2. 历史分数聚合实现

在 `saveAIScoringToDB` 函数中：

```javascript
// 保存历史评估记录
const historyRecord = {
    timestamp: new Date(),
    scores: {
        total: totalScore,
        indicators: { /* 各指标得分 */ }
    },
    comparisonGroup: schools.map(s => s.name) // 记录对比组
};

// 计算加权平均（新评估权重0.6，历史平均权重0.4）
const historicalScores = await getHistoricalScores(school._id);
const weightedAverage = calculateWeightedAverage(newScore, historicalScores);
```

### 3. 数据库结构扩展

```javascript
// 在School Schema中添加
'AI评估_历史记录': [{ 
    timestamp: Date,
    scores: Object,
    comparisonGroup: [String]
}],
'AI评估_聚合总分': Number, // 加权平均后的总分
'AI评估_评估次数': Number, // 评估次数
'AI评估_分数稳定性': Number // 分数标准差（越小越稳定）
```

## 监控指标

建议监控以下指标：
1. **分数一致性**：同一所学校在不同对比组中的分数差异
2. **评估次数**：每所学校的评估次数
3. **分数稳定性**：历史分数的标准差
4. **用户反馈**：用户对评估结果的满意度

## 预期效果

实施后预期：
- 同一所学校在不同对比组中分数差异 < 3分（95%置信区间）
- 评估次数 > 3次后，分数稳定性显著提升
- 用户对评估结果的信任度提升
