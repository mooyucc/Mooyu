# 学校数据获取工作流说明

## 当前状态

**已移除 DuckDuckGo 搜索功能，系统现在仅使用 AI 进行学校信息查询。**

### AI 搜索状态
- ✅ **AI 查询**：使用 Deepseek API 基于知识库查询学校信息
- ✅ **网站优先**：如果学校已有官方网站，AI 会优先基于网站信息进行查询
- ✅ **自动填充**：AI 自动整理并填入学校基础信息

## 当前工作流

### 第一步：AI 查询学校信息

**目标**：基于 AI 知识库和训练数据获取学校信息

**工作方式**：

1. **基础信息查询**
   - 学校名称、网址、国家、城市
   - 学校类型、涵盖学段
   - 课程信息（IB、AP、A-Level 等）

2. **网站信息优先**
   - 如果学校已有官方网站，AI 会优先访问网站获取信息
   - 如果网站无法访问，则基于 AI 知识库补充

3. **重点字段支持**
   - 用户可指定重点搜索的字段
   - AI 会对重点字段进行更详细的查询和验证

### 第二步：学校对比时调用 AI（评估分析）

**目标**：进行深度评估和对比分析

**当前状态**：✅ 已实现，不受影响

## 当前完整工作流

### 场景 1：用户搜索新学校

```
用户输入学校名称
    ↓
1. 检查数据库（避免重复）
    ↓ (如果不存在)
2. AI 查询学校信息
   - 基于 AI 知识库查询学校基础信息
   - 如果学校已有官方网站，优先基于网站信息查询
   - 提取结构化信息（名称、网址、类型、课程等）
    ↓
3. 数据验证和保存
   - 验证数据完整性
   - 检查关键字段
   - 保存到数据库
```

### 场景 2：补充学校信息（对比前）

```
用户选择学校进行对比
    ↓
1. 检查学校基础信息完整性
   - 识别缺失的关键字段
    ↓ (如果有缺失)
2. AI 补充缺失字段
   - 针对缺失字段进行 AI 查询
   - 用户可指定重点搜索的字段
   - AI 基于知识库补充缺失字段
    ↓
3. 更新数据库并继续对比
```

### 场景 3：强制刷新学校信息

```
用户点击"重新搜索"
    ↓
1. 保留现有网址（如果存在）
    ↓
2. AI 重新查询
   - 基于现有网址重新验证（如果存在）
   - 或基于 AI 知识库重新查询最新信息
    ↓
3. 更新数据库（保留序号和搜索次数）
```

## 优化建议

### 1. 增强 AI 提示词

- 明确要求 AI 基于知识库提供准确信息
- 对于不确定的信息，要求标注"未知"而不是猜测
- 对于关键字段（网址、课程），要求 AI 提供更详细的验证

### 2. 网站信息验证

- 如果学校已有官方网站，AI 会优先访问网站获取信息
- 建议添加网站访问验证机制，确保网站可访问
- 对于无法访问的网站，回退到 AI 知识库

### 3. 字段完整性检查

- 在保存数据前检查关键字段是否完整
- 对于缺失的关键字段，可以提示用户手动补充
- 对于非关键字段，可以留空或使用默认值

## 数据准确性提升策略

### 1. AI 知识库验证
- 基于 AI 训练数据中的信息
- 对于重要信息，AI 会进行多重验证
- 如果信息不确定，AI 会明确标注

### 2. 网站信息优先
- 如果学校已有官方网站，优先使用网站信息
- 网站信息通常更准确、更及时
- 网站无法访问时，回退到 AI 知识库

### 3. 人工审核建议
- 对于关键字段（如网址、课程），建议人工审核
- 可以添加人工审核标记功能
- 定期抽查数据准确性

## 注意事项

1. **AI 知识库限制**：AI 的知识库基于训练数据，可能存在信息滞后
2. **网站依赖**：如果学校没有官方网站或网站无法访问，只能依赖 AI 知识库
3. **成本控制**：AI API 调用有成本，建议合理控制调用频率
4. **数据验证**：建议定期验证数据准确性，特别是关键字段

## 监控指标

建议监控以下指标以评估系统效果：
- AI 查询成功率
- 字段完整率（特别是关键字段）
- 数据准确性（人工抽样验证）
- 用户满意度（学校信息准确性反馈）
